<ion-content [scrollY]="false">
  <div class="main-layout flex h-full w-full bg-[#f8f9fa]">
    <!-- MIDDLE CONTENT AREA -->
    <div
      class="content-area flex-1 flex flex-col h-full overflow-hidden relative"
    >
      <div class="p-6 pb-2">
        <div class="flex justify-between items-center mb-6">
          <div>
            <h1 class="text-3xl font-bold text-[#28c76f]">Manage Products</h1>
            <p class="text-gray-500">View and manage your products</p>
          </div>
        </div>

        <!-- CATEGORIES SECTION -->
        <div class="mb-6">
          <h2 class="text-xl font-semibold mb-3 text-[#28c76f]">Categories</h2>
          <div
            class="categories-wrapper flex gap-4 overflow-x-auto pb-2 scrollbar-hide"
          >
            @for (cat of categories; track $index) {
            <div
              class="cursor-pointer min-w-[120px] bg-white text-gray-600 hover:bg-green-50 hover:text-[#28c76f] text-center py-3 px-6 rounded-full shadow-sm border border-gray-100 font-medium transition-all whitespace-nowrap flex items-center justify-between gap-2"
            >
              <span>{{ cat.name }}</span>
            </div>
            }
          </div>
        </div>
      </div>

      <!-- PRODUCTS GRID -->
      <div class="flex-1 overflow-y-auto p-6 pt-2">
        <h2 class="text-xl font-semibold mb-4 text-[#28c76f]">All Products</h2>

        <div
          class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 pb-20"
        >
          @for (product of products; track $index) {
          <div
            class="product-card group bg-white border border-gray-100 rounded-[30px] p-4 shadow-sm hover:shadow-lg transition-all duration-300 flex flex-col items-center text-center relative"
          >
            <div class="relative w-full h-48 mb-4 overflow-hidden rounded-xl">
              <img
                [src]="product.imageUrl"
                class="w-full h-full object-cover"
                alt="{{product.name}}"
              />
            </div>

            <div class="w-full flex justify-between items-center px-4">
              <h2
                class="text-lg font-bold text-gray-800 mb-1 line-clamp-1"
                title="{{ product.name }}"
              >
                {{ product.name }}
              </h2>

              <p class="text-sm text-gray-500 mb-2">{{ product.category}}</p>

              <p class="text-[#28c76f] text-xl font-bold mb-2">
                ৳ {{ product.price }}
              </p>
            </div>
            <div class="absolute top-3 right-3 flex gap-2 z-10">
              <button
                (click)="deleteProduct(product.id)"
                class="bg-red-50 hover:bg-red-100 text-red-500 p-2 rounded-full transition-colors"
              >
                <img
                  src="../../assets/icon/trash-delete-bin.svg"
                  class="w-5 h-5"
                />
              </button>
            </div>
            <div class="w-full">
              <button
                (click)="editProduct(product)"
                class="mt-auto w-full t bg-[#eafbf2] text-[#28c76f] justify-center hover:bg-[#28c76f] hover:text-white font-semibold py-2 px-6 rounded-full transition-colors duration-200 flex items-center gap-2"
              >
                <span>Edit Product</span>
              </button>
            </div>
          </div>

          }
        </div>
      </div>
    </div>

    <!-- RIGHT SIDE PANEL -->
    <div
      class="right-panel-wrapper w-[350px] h-full bg-white shadow-[-5px_0_15px_rgba(0,0,0,0.05)] z-20"
    >
      <app-right-side-panel mode="upload">
        <div class="p-6">
          <h1 class="text-2xl font-bold text-gray-800 mb-6">
            {{ isEditMode ? 'Update Product' : 'Create Product' }}
          </h1>

          <form [formGroup]="productForm" (submit)="upload()" class="space-y-4">
            <!-- Product Name -->
            <mat-form-field
              appearance="outline"
              style="width: 100%"
              class="ion-align-items-center"
            >
              <mat-label class="font-gotham_book text-sm text-black"
                >Product Name</mat-label
              >
              <input
                matInput
                type="text"
                formControlName="name"
                floatLabel="always"
                placeholder="Enter product name"
              />
            </mat-form-field>
            <mat-form-field appearance="outline" style="width: 100%">
              <mat-label>Unit (e.g. 1kg, 4 pcs)</mat-label>
              <input matInput formControlName="unit" placeholder="Enter unit" />
            </mat-form-field>

            <!-- Price -->
            <mat-form-field
              appearance="outline"
              style="width: 100%"
              class="ion-align-items-center"
            >
              <mat-label class="font-gotham_book text-sm text-black"
                >Price (৳)</mat-label
              >
              <input
                matInput
                type="text"
                formControlName="price"
                floatLabel="always"
                placeholder="Enter price"
              />
            </mat-form-field>
            <mat-form-field appearance="outline" style="width: 100%">
              <mat-label>Discount Percent (%)</mat-label>
              <input
                matInput
                type="number"
                formControlName="discountPercent"
                placeholder="0"
              />
            </mat-form-field>

            <!-- Category -->

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Category</label
              >
              <select
                formControlName="categoryName"
                class="w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#28c76f] focus:border-transparent outline-none bg-white"
              >
                <option value="" disabled selected>Select Category</option>
                @for (category of categories; track $index) {
                <option [value]="category.name">{{ category.name }}</option>
                }
              </select>
            </div>

            <!-- Description -->
            <mat-form-field
              appearance="outline"
              style="width: 100%"
              class="ion-align-items-center"
            >
              <mat-label class="font-gotham_book text-sm text-black"
                >Description</mat-label
              >
              <textarea
                matInput
                formControlName="description"
                floatLabel="always"
                placeholder="Enter product description"
              ></textarea>
            </mat-form-field>

            <!-- Image Upload -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Product Image</label
              >
              <input
                type="file"
                accept="image/*"
                (change)="onFileSelected($event)"
                class="w-full p-2 border border-gray-200 rounded-xl bg-white file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-[#eafbf2] file:text-[#28c76f] hover:file:bg-[#28c76f] hover:file:text-white"
              />
            </div>

            <!-- Submit Button -->
            <button
              type="submit"
              [disabled]="loading || !productForm.valid || (!selectedFile && !isEditMode)"
              class="w-full bg-[#28c76f] text-white py-3 rounded-xl font-semibold disabled:bg-gray-300 disabled:cursor-not-allowed hover:bg-[#24b364] transition-colors"
            >
              {{ loading ? (isEditMode ? 'Updating...' : 'Creating...') :
              (isEditMode ? 'Update Product' : 'Create Product') }}
            </button>
          </form>
        </div>
      </app-right-side-panel>
    </div>
  </div>
</ion-content>
